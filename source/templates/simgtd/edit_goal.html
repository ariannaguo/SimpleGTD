{% extends "base.html" %}

{% block title %}Edit Goal{% endblock %}
{% block myScript %}
    <script src="{{ STATIC_URL }}scripts/gtd.js"></script>
{% endblock %}

{% block loadScript %}
     <script>
        $(function() {
            $( "#due_date" ).datepicker({
                showOtherMonths: true,
                selectOtherMonths: true
            });

            var status = {{ goal.status.id }};
            $("#status").val(status);

            var gid = {{ goal.id }};
            $("#delete").on('click', function() {
                var sid = gtd.status.canceled.id;
                if(gid && sid) {
                    $.post( "/goal/status/" + gid,
                        { csrfmiddlewaretoken: '{{ csrf_token }}', sid: sid },
                        function(data) {
                            if(data.result == 'OK'){
                                window.location.replace('/goal/list/')
                            } else {
                                alert(data.message);
                            }
                    });
                }
            });
        });
    </script>
{% endblock %}

{% block content %}

    {% if errors %}
        <ul>
            {% for e in errors %}
                <li>{{ e }}</li>
            {% endfor %}
        </ul>
    {% endif %}

    <form action="/goal/edit/{{ goal.id }}" method="post">

        {% csrf_token %}
        <div id="add_goal_setting">
            <textarea type="text" id="quickTitle" name="title"
                      value placeholder="Add a goal..." autofocus="auotofocus"
                      style="height:30px">{{ goal.subject }}</textarea>
            <div class="field">
                <label class="field_label"  for="duration">Duration (days)</label>
                <input id="duration" type="number" name="duration" value="{{ goal.duration }}" class="field_label_input">
            </div>
            <div class="field">
                <label class="field_label" for="due_date">Due Date</label>
                <input id="due_date" type="text" name="due_date" class="field_label_input" value="{{ goal.due_date|date:'m/d/Y' }}">
            </div>
            <div class="field">
                <label class="field_label" for="progress">Progress</label>
                <input id="progress" type="text" name="progress" class="field_label_input" value="{{ goal.progress }}">
            </div>
            <div class="field">
                <label class="field_label" for="status">Status</label>
                <select id="status" name="status">
                    <option value="" selected="selected">---select the status---</option>
                    {% for s in status %}
                        <option value="{{ s.id }}">{{ s.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="field_button">
                <input type="submit" class="save" value="Save">
                <input type="button" id="delete" class="save" value="DELETE?">
                <a href="/goal/list" class="cancel">Cancel</a>
            </div>
        </div>

    </form>

{% endblock %}
